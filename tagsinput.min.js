/*! TagsInput.js v1.0.0 | MIT License */
(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):(global=typeof globalThis!=='undefined'?globalThis:global||self,global.TagsInput=factory());}(this,function(){'use strict';class TagsInput{constructor(el,options={}){this._el=typeof el==='string'?document.querySelector(el):el;if(!this._el||this._el.tagName!=='INPUT'){throw new Error('[TagsInput]L\'élément cible doit être un<input>.');}this._opts=Object.assign({initialTags:[],separators:[','],maxTags:Infinity,minLength:1,maxLength:Infinity,allowDuplicates:false,caseSensitive:true,validate:null,transform:v=>v.trim(),suggestions:[],suggestionsLimit:6,theme:'',placeholder:this._el.placeholder||'',readonly:false,disabled:false,},options);this._tags=[];this._initialTags=[...this._opts.initialTags];this._listeners={};this._suggestionIndex=-1;this._visibleSuggestions=[];this._silent=false;this._build();this._initialTags.forEach(t=>this.add(t));if(this._opts.readonly)this.setReadonly(true);if(this._opts.disabled)this.setDisabled(true);}_build(){this._wrapper=document.createElement('div');this._wrapper.className=['tags-input-wrapper',this._opts.theme?'theme-'+this._opts.theme:''].filter(Boolean).join(' ');this._input=document.createElement('input');this._input.type='text';this._input.className='tags-real-input';this._input.placeholder=this._opts.placeholder;this._input.autocomplete='off';this._input.spellcheck=false;this._wrapper.appendChild(this._input);this._el.parentNode.insertBefore(this._wrapper,this._el);this._el.style.display='none';this._wrapper.appendChild(this._el);if(this._opts.suggestions.length){this._suggBox=document.createElement('div');this._suggBox.className='tags-suggestions';this._suggBox.style.display='none';this._wrapper.parentNode.appendChild(this._suggBox);}this._bindEvents();}_bindEvents(){this._wrapper.addEventListener('click',e=>{if(!e.target.classList.contains('tag-remove'))this._input.focus();});this._input.addEventListener('keydown',e=>this._onKeydown(e));this._input.addEventListener('input',()=>this._onInput());this._input.addEventListener('blur',()=>setTimeout(()=>this._hideSuggestions(),150));}_onKeydown(e){const val=this._input.value;if(this._opts.separators.includes(e.key)){e.preventDefault();this.add(val);this._input.value='';this._hideSuggestions();return;}switch(e.key){case 'Enter':e.preventDefault();if(this._suggestionIndex>=0&&this._visibleSuggestions.length){this.add(this._visibleSuggestions[this._suggestionIndex]);}else{this.add(val);}this._input.value='';this._hideSuggestions();break;case 'Backspace':if(!val&&this._tags.length)this.removeAt(this._tags.length-1);break;case 'Escape':this._hideSuggestions();break;case 'ArrowDown':e.preventDefault();this._moveSuggestion(1);break;case 'ArrowUp':e.preventDefault();this._moveSuggestion(-1);break;}}_onInput(){const val=this._input.value;for(const sep of this._opts.separators){if(val.includes(sep)){const parts=val.split(sep);parts.slice(0,-1).forEach(p=>this.add(p));this._input.value=parts[parts.length-1];return;}}this._showSuggestions(val);}_showSuggestions(query){if(!this._suggBox||!query){this._hideSuggestions();return;}const q=query.toLowerCase();const matches=this._opts.suggestions.filter(s=>s.toLowerCase().includes(q)&&!this._hasExact(s)).slice(0,this._opts.suggestionsLimit);if(!matches.length){this._hideSuggestions();return;}this._visibleSuggestions=matches;this._suggestionIndex=-1;this._suggBox.innerHTML='';matches.forEach(m=>{const item=document.createElement('div');item.className='tags-suggestion-item';const idx=m.toLowerCase().indexOf(q);item.innerHTML=this._escHtml(m.slice(0,idx))+'<mark>'+this._escHtml(m.slice(idx,idx+q.length))+'</mark>'+this._escHtml(m.slice(idx+q.length));item.addEventListener('mousedown',()=>{this.add(m);this._input.value='';this._hideSuggestions();});this._suggBox.appendChild(item);});this._suggBox.style.display='block';}_hideSuggestions(){if(this._suggBox){this._suggBox.style.display='none';this._suggestionIndex=-1;this._visibleSuggestions=[];}}_moveSuggestion(dir){if(!this._suggBox||this._suggBox.style.display==='none')return;const items=this._suggBox.querySelectorAll('.tags-suggestion-item');if(!items.length)return;if(this._suggestionIndex>=0)items[this._suggestionIndex].classList.remove('active');this._suggestionIndex=Math.max(-1,Math.min(items.length-1,this._suggestionIndex+dir));if(this._suggestionIndex>=0)items[this._suggestionIndex].classList.add('active');}_normalize(value){return this._opts.transform?this._opts.transform(String(value)):String(value).trim();}_hasExact(value){const cmp=this._opts.caseSensitive?v=>v:v=>v.toLowerCase();return this._tags.some(t=>cmp(t)===cmp(value));}_isDuplicate(value){return this._opts.allowDuplicates?false:this._hasExact(value);}_validate(value){if(value.length<this._opts.minLength)return false;if(value.length>this._opts.maxLength)return false;if(this._isDuplicate(value))return false;if(typeof this._opts.validate==='function'){const r=this._opts.validate(value);if(r===false||typeof r==='string')return false;}return true;}_shake(){this._wrapper.classList.add('tags-invalid');setTimeout(()=>this._wrapper.classList.remove('tags-invalid'),400);}_renderTag(value){const tag=document.createElement('span');tag.className='tag-item';tag.textContent=value;const btn=document.createElement('button');btn.type='button';btn.className='tag-remove';btn.innerHTML='&times;';btn.setAttribute('aria-label','Supprimer '+value);btn.addEventListener('click',e=>{e.stopPropagation();this.remove(value);});tag.appendChild(btn);this._wrapper.insertBefore(tag,this._input);}_syncHidden(){this._el.value=this._tags.join(',');}_escHtml(str){return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}_emit(event,data){if(this._silent)return;(this._listeners[event]||[]).forEach(fn=>{try{fn(data);}catch(err){console.error('[TagsInput]Erreur dans le handler "'+event+'":',err);}});}add(value){if(this._opts.readonly||this._opts.disabled)return false;const v=this._normalize(value);if(!v)return false;if(this._tags.length>=this._opts.maxTags){this._shake();this._emit('max',{value:v,tags:this.getTags()});return false;}if(!this._validate(v)){this._shake();this._emit('invalid',{value:v,tags:this.getTags()});return false;}this._tags.push(v);this._renderTag(v);this._syncHidden();this._emit('add',{value:v,tags:this.getTags()});this._emit('change',{tags:this.getTags()});return true;}remove(value){const idx=this._tags.indexOf(value);if(idx===-1)return false;return this.removeAt(idx);}removeAt(index){if(this._opts.readonly||this._opts.disabled)return false;if(index<0||index>=this._tags.length)return false;const value=this._tags[index];this._tags.splice(index,1);const tagEls=this._wrapper.querySelectorAll('.tag-item');if(tagEls[index]){tagEls[index].classList.add('removing');setTimeout(()=>tagEls[index]&&tagEls[index].remove(),160);}this._syncHidden();this._emit('remove',{value,tags:this.getTags()});this._emit('change',{tags:this.getTags()});return true;}getTags(){return[...this._tags];}has(value){return this._tags.includes(value);}count(){return this._tags.length;}fill(arr){this._silent=true;try{this.clear();arr.forEach(v=>this.add(v));}finally{this._silent=false;}this._emit('change',{tags:this.getTags()});}replace(arr){this.fill(arr);}clear(){this._tags=[];this._wrapper.querySelectorAll('.tag-item').forEach(el=>el.remove());this._syncHidden();this._emit('clear',{tags:[]});this._emit('change',{tags:[]});}reset(){this.fill(this._initialTags);}focus(){this._input.focus();}setReadonly(bool){this._opts.readonly=bool;this._input.style.display=bool?'none':'';this._wrapper.querySelectorAll('.tag-remove').forEach(b=>b.style.display=bool?'none':'');}setDisabled(bool){this._opts.disabled=bool;this._wrapper.style.opacity=bool?'0.45':'';this._wrapper.style.pointerEvents=bool?'none':'';}on(event,fn){if(!this._listeners[event])this._listeners[event]=[];this._listeners[event].push(fn);}off(event,fn){if(!this._listeners[event])return;this._listeners[event]=this._listeners[event].filter(f=>f!==fn);}destroy(){this._el.style.display='';this._wrapper.parentNode.insertBefore(this._el,this._wrapper);this._wrapper.remove();if(this._suggBox)this._suggBox.remove();this._listeners={};}}return TagsInput;}));